<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vivid Lovely Character Generator</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }
        select, button { width: 100%; margin-bottom: 10px; padding: 10px; font-size: 16px; }
        .option-container { display: flex; align-items: center; gap: 10px; }
        .option-container select { flex-grow: 1; }
        .reroll-button { width: auto; padding: 10px; }
        /* Added styling to distinguish the outputs if needed */
        #characterResult { margin-top: 20px; font-weight: bold; }
        #sdPromptResult { margin-top: 10px; font-family: monospace; font-size: 0.9em; background-color: #f0f0f0; padding: 10px; border-radius: 5px; }
    </style>
    <script src="character-generator.js"></script>
</head>
<body>
    <h1>Vivid Lovely Character Generator</h1>

    <button id="rerollAllButton">Reroll All</button> <!- ** NEW: Reroll All Button ** -->

    <div class="option-container">
        <label for="realm">Realm:</label>
        <select id="realm"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="location">Location:</label>
        <select id="location"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="species">Species:</label>
        <select id="species"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="occupation">Occupation:</label>
        <select id="occupation"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="special_features">Special Features:</label>
        <select id="special_features"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="accessories">Accessories:</label>
        <select id="accessories"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="body_type">Body Type:</label>
        <select id="body_type"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="disposition">Disposition:</label>
        <select id="disposition"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="pose">Pose:</label>
        <select id="pose"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <h2>Phenotype Details</h2>

    <div class="option-container">
        <label for="hair_style">Hair Style:</label>
        <select id="hair_style"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="hair_color">Hair Color:</label>
        <select id="hair_color"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="eye_color">Eye Color:</label>
        <select id="eye_color"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="skin_color">Skin Color:</label>
        <select id="skin_color"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <button id="generateButton">Generate Character</button>

    <h2 style="margin-top: 20px;">Character Description:</h2>
    <p id="characterResult"></p>

    <h2 style="margin-top: 20px;">Stable Diffusion Prompt:</h2>
    <p id="sdPromptResult"></p>

    <script>
        // ** JAVASCRIPT CODE (Modified and Added Functions) **

        function populateDropdown(selectId, options) {
            // ... (populateDropdown function - No changes) ...
        }

        function updateOptions() {
            // ... (updateOptions function - No changes) ...
        }

        function updatePhenotypeOptions() {
            // ... (updatePhenotypeOptions function - No changes) ...
        }

        function reroll(selectId) {
            // ... (reroll function - No changes) ...
        }

        function generateCharacter() {
            // ... (generateCharacter function - No changes) ...
        }

        // ** NEW FUNCTION: Reroll All Dropdowns **
        function rerollAll() {
            const dropdownIds = [ // List of all select element IDs
                "realm", "location", "species", "occupation", "special_features",
                "accessories", "body_type", "disposition", "pose", "hair_style",
                "hair_color", "eye_color", "skin_color"
            ];
            dropdownIds.forEach(id => reroll(id)); // Call reroll for each dropdown
        }


        // Initial population of dropdowns
        const realms = Object.keys(parameters.realms);
        const bodyTypes = parameters.body_type;
        const dispositions = parameters.disposition;
        const poses = parameters.pose;

        populateDropdown("realm", realms);
        populateDropdown("body_type", bodyTypes);
        populateDropdown("disposition", dispositions);
        populateDropdown("pose", poses);

        updateOptions(); // Initialize location, species, etc. based on default realm


        // ** EVENT LISTENERS - Attach after DOM elements are ready and functions are defined **
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('realm').addEventListener('change', updateOptions);
            document.getElementById('species').addEventListener('change', updatePhenotypeOptions);
            document.getElementById('generateButton').addEventListener('click', generateCharacter);
            document.getElementById('rerollAllButton').addEventListener('click', rerollAll); // ** NEW: Event listener for Reroll All button **


            const rerollButtons = document.querySelectorAll('.reroll-button');
            rerollButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const previousSibling = button.previousElementSibling;
                    if (previousSibling) {
                        const selectId = previousSibling.id;
                        reroll(selectId);
                    } else {
                        console.error("Error: Previous sibling is null for a reroll button!", button);
                    }
                });
            });

            // ** NEW: Randomize all dropdowns on page load **
            rerollAll();
        });


    </script>
</body>
</html>
