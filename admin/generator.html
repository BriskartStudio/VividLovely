<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vivid Lovely Character Generator</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }
        select, button { width: 100%; margin-bottom: 10px; padding: 10px; font-size: 16px; }
        .option-container { display: flex; align-items: center; gap: 10px; }
        .option-container select { flex-grow: 1; }
        .reroll-button { width: auto; padding: 10px; }
    </style>
</head>
<body>
    <h1>Vivid Lovely Character Generator</h1>

    <div class="option-container">
        <label for="realm">Realm:</label>
        <select id="realm"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="location">Location:</label>
        <select id="location"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="species">Species:</label>
        <select id="species"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="occupation">Occupation:</label>
        <select id="occupation"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="special_features">Special Features:</label>
        <select id="special_features"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="accessories">Accessories:</label>
        <select id="accessories"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="body_type">Body Type:</label>
        <select id="body_type"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="disposition">Disposition:</label>
        <select id="disposition"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="pose">Pose:</label>
        <select id="pose"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <h2>Phenotype Details</h2>

    <div class="option-container">
        <label for="hair_style">Hair Style:</label>
        <select id="hair_style"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="hair_color">Hair Color:</label>
        <select id="hair_color"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="eye_color">Eye Color:</label>
        <select id="eye_color"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <div class="option-container">
        <label for="skin_color">Skin Color:</label>
        <select id="skin_color"></select>
        <button class="reroll-button">Reroll</button>
    </div>

    <button>Generate Character</button>

    <p id="result"></p>

    <script src="character-generator.js"></script>
    <script>
        function generateCharacter() {
            const result = document.getElementById('result');
            result.textContent = 'Character generated!';
        }
        
        function reroll(selectId) {
            const select = document.getElementById(selectId);
            const options = Array.from(select.options).map(option => option.value);
            const randomIndex = Math.floor(Math.random() * options.length);
            select.value = options[randomIndex];

            if (selectId === "realm") {
                updateOptions();
            }
            if (selectId === "species") {
                updatePhenotypeOptions();
            }
        }
 function updatePhenotypeOptions() {
            const species = document.getElementById("species").value;
            const realm = document.getElementById("realm").value;
            const realmSpecies = parameters.realms[realm].species;

            if (parameters.phenotypes[species]) {
                const phenotypeData = parameters.phenotypes[species];
                populateDropdown("hair_style", phenotypeData.hair_styles);
                populateDropdown("hair_color", phenotypeData.hair_colors);
                populateDropdown("eye_color", phenotypeData.eye_colors);
                populateDropdown("skin_color", phenotypeData.skin_colors);
            } else {
                // If species doesn't have phenotype data, clear the phenotype dropdowns.
                populateDropdown("hair_style", []);
                populateDropdown("hair_color", []);
                populateDropdown("eye_color", []);
                populateDropdown("skin_color", []);
            }
        }

  if (parameters.phenotypes[species]) {
    const phenotypeData = parameters.phenotypes[species];
    populateDropdown("hair_style", phenotypeData.hair_styles);
    populateDropdown("hair_color", phenotypeData.hair_colors);
    populateDropdown("eye_color", phenotypeData.eye_colors);
    populateDropdown("skin_color", phenotypeData.skin_colors);
  } else {
    // If species doesn't have phenotype data, clear the phenotype dropdowns.
    populateDropdown("hair_style", []);
    populateDropdown("hair_color", []);
    populateDropdown("eye_color", []);
    populateDropdown("skin_color", []);
  }


function updateOptions() {
    const realm = document.getElementById("realm").value;
    const realmData = parameters.realms[realm];

    populateDropdown("location", realmData.locations);
    populateDropdown("species", realmData.species);
    populateDropdown("occupation", realmData.occupations);
    populateDropdown("special_features", realmData.special_features);
    populateDropdown("accessories", realmData.accessories);

    updatePhenotypeOptions(); // Update phenotype options based on the new species
}

  if (selectId === "realm") {
    updateOptions();
  }
  if (selectId === "species") {
      updatePhenotypeOptions();
  }

const realms = Object.keys(parameters.realms);
const bodyTypes = parameters.body_type;
const dispositions = parameters.disposition;
const poses = parameters.pose;

function populateDropdown(selectId, options) {
  const select = document.getElementById(selectId);
  select.innerHTML = ""; // Clear existing options
  options.forEach(option => {
    const optionElement = document.createElement("option");
    optionElement.value = option;
    optionElement.textContent = option;
    select.appendChild(optionElement);
  });
}

populateDropdown("realm", realms);
populateDropdown("body_type", bodyTypes);
populateDropdown("disposition", dispositions);
populateDropdown("pose", poses);

// Initialize location and species based on the default realm
updateOptions();

// **ADD EVENT LISTENERS HERE AFTER ALL FUNCTIONS and DOM are ready**
        document.getElementById('realm').addEventListener('change', updateOptions);
        document.getElementById('species').addEventListener('change', updatePhenotypeOptions);

        // Re-attach onclick for reroll buttons
        const rerollButtons = document.querySelectorAll('.reroll-button');
        rerollButtons.forEach(button => {
            const selectId = button.previousElementSibling.id; // Get the select ID from the previous element
            button.addEventListener('click', function() { reroll(selectId); });
        });

        // Re-attach onclick for "Generate Character" button
        const generateButton = document.querySelector('button:not(.reroll-button)'); // Select the button that is NOT a reroll button
        generateButton.addEventListener('click', generateCharacter);
    </script>
</body>
</html>
